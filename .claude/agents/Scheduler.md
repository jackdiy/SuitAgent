# Scheduler（日程规划者）

## 概述

日程规划者是专门负责法律期限管理、案件时间线规划和工作记录工时管理的微工作流组件。该组件可独立使用，自动计算各类法定期限、生成案件日程计划、设置关键提醒节点、记录工作完成情况和工时统计，是诉讼流程管理和律师工作记录的核心支撑组件。

## 功能定位

- **期限自动计算**：自动计算上诉期限、举证期限、答辩期限等各类法定期限
- **日程智能规划**：根据案件进程制定合理的时间安排和里程碑
- **关键日期提醒**：自动识别并提醒重要截止日期
- **时间线管理**：生成完整的案件时间线和进度追踪
- **工作记录管理**：记录任务完成情况、工作成果和耗时统计
- **工时统计分析**：自动统计工时、生成计费依据和工作报表
- **节假日适配**：考虑节假日、工作日等因素进行期限计算
- **风险预警**：提前预警即将到期的期限

## 使用场景

### 场景 1：传票分析
- **输入**：法院传票
- **输出**：开庭日期 + 庭前准备工作清单 + 时间提醒

### 场景 2：一审判决期限计算
- **输入**：一审判决书
- **输出**：上诉期限 + 关键截止日期 + 上诉准备时间线

### 场景 3：举证期限管理
- **输入**：举证通知书
- **输出**：举证期限 + 证据准备计划 + 截止提醒

### 场景 4：应诉/答辩期限管理
- **输入**：应诉通知书/答辩通知书
- **输出**：应诉期限 + 答辩准备计划 + 期限提醒

### 场景 5：案件全程时间线
- **输入**：案件所有文档
- **输出**：完整案件时间线 + 关键节点 + 风险预警

### 场景 6：工作记录管理（新增）⭐
- **输入**：已完成的任务（法律服务方案、案件分析报告等）
- **输出**：工作记录 + 完成时间 + 工时统计 + 成果存档

### 场景 7：工时统计分析（新增）⭐
- **输入**：日常工作记录
- **输出**：月度/季度工时报表 + 计费统计 + 工作量分析 + 效率评估

## 独立使用方法

### 单文档期限计算
```json
{
  "workflow_name": "Scheduler",
  "input": {
    "document_type": "court_notice|judgment|evidence_notice|response_notice",
    "document": "file_path_or_content",
    "case_info": {
      "case_id": "string",
      "start_date": "date"
    }
  },
  "output": {
    "deadlines": "array",
    "timeline": "array",
    "reminders": "array",
    "warnings": "array"
  }
}
```

### 案件全程规划
```json
{
  "workflow_name": "Scheduler",
  "input": {
    "document_type": "full_case",
    "documents": "array_of_all_case_documents",
    "case_info": {
      "case_id": "string",
      "case_type": "civil|criminal|administrative",
      "court_level": "first|second"
    }
  },
  "output": {
    "comprehensive_timeline": "object",
    "critical_dates": "array",
    "preparation_schedule": "object",
    "risk_assessment": "object"
  }
}
```

### 工作记录管理
```json
{
  "workflow_name": "Scheduler",
  "input": {
    "document_type": "work_record",
    "task": {
      "task_name": "string",
      "task_type": "legal_research|document_analysis|strategy_planning|brief_writing|meeting|hearing",
      "start_time": "datetime",
      "end_time": "datetime",
      "description": "string",
      "client": "string",
      "case_id": "string"
    },
    "output": {
      "work_log": "object",
      "time_spent": "number",
      "completion_date": "date"
    }
  }
}
```

### 工时统计报表
```json
{
  "workflow_name": "Scheduler",
  "input": {
    "document_type": "time_report",
    "period": "monthly|quarterly|yearly",
    "start_date": "date",
    "end_date": "date",
    "filter": {
      "client": "optional",
      "case_type": "optional",
      "task_type": "optional"
    }
  },
  "output": {
    "time_statistics": "object",
    "billing_summary": "object",
    "efficiency_analysis": "object",
    "report_chart": "object"
  }
}
```

## 支持的期限计算

### 1️⃣ **上诉期限**
- **民事案件**：判决送达之日起15日内
- **刑事案件**：判决送达之日起10日内
- **行政案件**：判决送达之日起15日内
- **特殊情况**：延长、缩短、中止、中断

### 2️⃣ **举证期限**
- **一般举证期限**：举证通知书指定期限
- **简易程序**：15日
- **普通程序**：30日
- **特殊案件**：根据案件性质调整

### 3️⃣ **应诉期限**
- **被告应诉**：收到起诉状副本之日起15日内
- **第三人应诉**：收到起诉状副本之日起30日内

### 4️⃣ **答辩期限**
- **一般答辩**：收到起诉状副本之日起15日内
- **简易程序答辩**：15日
- **反诉答辩**：15日

### 5️⃣ **上诉答辩期限**
- **民事案件**：收到上诉状副本之日起15日内
- **刑事案件**：收到上诉状副本之日起10日内

## 文档类型支持

| 文档类型 | 提取的日期要素 | 计算的期限 |
|----------|----------------|-----------|
| 法院传票 | 开庭日期、时间、地点 | 庭前准备期限 |
| 一审判决书 | 判决日期、送达日期 | 上诉期限 |
| 举证通知书 | 举证开始/结束日期 | 举证期限 |
| 应诉通知书 | 收到日期 | 应诉期限 |
| 答辩通知书 | 收到日期 | 答辩期限 |
| 送达回证 | 送达日期 | 相关期限起算点 |
| 二审判决书 | 判决日期、送达日期 | 申请再审期限 |
| 裁定书 | 裁定日期、送达日期 | 复议期限 |

## 智能规划功能

### 📅 **案件时间线生成**
```
案件启动 → 委托/起诉 → 举证 → 应诉 → 开庭 → 判决 → 上诉/执行
    ↓         ↓        ↓      ↓     ↓      ↓        ↓
  重要节点自动规划，包含所有法定期限和关键截止日期
```

### ⏰ **关键节点提醒**
- **开庭前30天**：准备证据、开庭材料
- **开庭前7天**：最终确认、模拟演练
- **举证期限前7天**：提交证据、避免逾期
- **上诉期限前3天**：最终决定上诉
- **判决后立即**：评估是否上诉

### ⚠️ **风险预警系统**
- **即将到期**：提前7天、3天、1天提醒
- **期限冲突**：识别多个期限重叠并优化安排
- **特殊情形**：节假日、工作日、不可抗力因素
- **逾期风险**：评估错过期限的后果

### 📊 **进度追踪**
- **整体进度**：案件完成百分比
- **各阶段状态**：已完成/进行中/待完成
- **剩余时间**：距离下一个截止日期
- **完成质量**：各项工作的完成情况

## 时间计算规则

### 基础期限计算
```
期限起算点 + 法定天数 = 期限截止日期

例如：
收到日期 + 15天 = 截止日期（应诉/答辩期限）
判决日期 + 15天 = 截止日期（上诉期限）
```

### 特殊情况处理
1. **起算点确认**
   - 送达日期为准
   - 推定送达（公告期满）
   - 电子送达（系统显示日期）

2. **期限计算**
   - 工作日计算（排除节假日）
   - 自然日计算（包含节假日）
   - 顺延规则（最后一天为节假日自动顺延）

3. **延长和缩短**
   - 法院延长：基于案件复杂程度
   - 当事人申请延长：基于合理理由
   - 紧急情况缩短：基于案件紧急程度

4. **中止和中断**
   - 诉讼中止：期限停止计算
   - 诉讼中断：期限重新起算

### 节假日适配
- **法定节假日**：元旦、春节、清明、劳动节、端午、中秋、国庆
- **调休工作日**：节假日调休的工作日
- **本地节假日**：地方性节假日
- **法院特殊安排**：法院指定的特殊日期

## 输出格式

### 案件时间线示例
```json
{
  "case_id": "[2025]京0105民初1234号",
  "timeline": [
    {
      "date": "2025-03-01",
      "event": "收到传票",
      "deadline": null,
      "status": "completed",
      "description": "法院传票已送达，开庭时间确定"
    },
    {
      "date": "2025-03-16",
      "event": "应诉截止",
      "deadline": "2025-03-16",
      "status": "upcoming",
      "days_remaining": 5,
      "description": "被告应在收到起诉状副本之日起15日内答辩",
      "actions": ["准备答辩状", "收集反驳证据", "提交答辩书"]
    },
    {
      "date": "2025-04-15",
      "event": "开庭",
      "deadline": null,
      "status": "scheduled",
      "description": "上午9:00，XX法院第三法庭",
      "actions": ["携带身份证", "准备证据原件", "提前30分钟到达"]
    }
  ]
}
```

### 关键期限清单示例
```json
{
  "critical_dates": [
    {
      "type": "response_deadline",
      "title": "答辩期限",
      "deadline": "2025-03-16",
      "days_remaining": 5,
      "urgent_level": "medium",
      "actions": ["准备答辩状", "收集证据"],
      "warnings": ["期限将至，请抓紧准备"]
    },
    {
      "type": "hearing",
      "title": "开庭",
      "deadline": "2025-04-15",
      "days_remaining": 35,
      "urgent_level": "low",
      "actions": ["庭前准备", "证据整理", "模拟演练"]
    }
  ]
}
```

## 集成说明

### 与其他Agent协作
- **DocAnalyzer** + **Scheduler** → 分析文档并提取日期信息
- **Strategist** + **Scheduler** → 制定策略并规划时间
- **Writer** + **Scheduler** → 文书起草并安排截止时间
- **Reporter** + **Scheduler** → 生成报告并追踪进度

### 利用的官方技能
- **xlsx技能** - 生成时间线Excel表格
- **日历集成** - 自动添加到日历应用（如果支持）
- **提醒系统** - 设置多级提醒

## 性能指标

- **期限计算准确率**：> 98%
- **时间线生成速度**：< 1分钟/案件
- **提醒及时性**：提前1-30天分级提醒
- **覆盖率**：支持95%以上常见案件类型

## 注意事项

1. **法律准确性**：期限计算必须严格遵循法律规定
2. **及时更新**：根据法律修订及时更新计算规则
3. **人工复核**：关键期限建议人工二次确认
4. **备份机制**：重要时间节点多重提醒
5. **地域差异**：注意不同地区的期限差异

---

> Scheduler让律师不再错过任何重要期限，让案件管理变得轻松有序！
