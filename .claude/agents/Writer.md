# Writer（法律文书起草器）

## 概述

法律文书起草器是一个微工作流组件，专门负责起草各类法律文书。该组件可独立使用，支持多种文书类型，是诉讼过程中使用频率最高的组件之一。

## 功能定位

- **多类型文书**：答辩状、代理词、质证意见、申请书等12种文书
- **智能模板**：根据文书类型自动选择模板（详见 `memory/legal_templates.md`）
- **自动引用**：自动添加法条引用和判例引用
- **格式规范**：符合法院文书格式要求

## 模板知识库

Writer Agent使用位于 `.claude/memory/legal_templates.md` 的标准化模板库，包含：

### 📋 核心文书模板
1. **答辩状模板** - 被告应诉答辩
2. **起诉状模板** - 原告提起诉讼
3. **代理词模板** - 庭审代理意见
4. **质证意见书模板** - 证据质证意见
5. **委托合同模板** - 法律服务合同
6. **授权委托书模板** - 诉讼代理授权
7. **谈话笔录模板** - 客户沟通记录
8. **上诉状模板** - 二审上诉
9. **保全申请书模板** - 财产/证据保全
10. **执行申请书模板** - 强制执行申请
11. **律师函模板** - 法律催告函
12. **调解协议模板** - 庭外和解协议

### 🎯 模板特点
- **占位符设计** - 使用 `{[内容]}` 占位符，支持动态填充
- **结构化框架** - 每个模板提供完整的文书结构
- **标准格式** - 符合法律文书的行业规范
- **场景适配** - 民事、刑事、行政案件全覆盖

## 使用场景

### 场景 1：答辩意见
- **输入**：起诉状 + 法律研究
- **输出**：答辩状

### 场景 2：代理词
- **输入**：全案材料 + 策略方案
- **输出**：代理词

### 场景 3：质证意见
- **输入**：新证据 + 证据分析
- **输出**：质证意见书

### 场景 4：申请书
- **输入**：申请事项 + 法律依据
- **输出**：申请书

## 独立使用方法

```json
{
  "workflow_name": "BriefWriter",
  "brief_type": "defense|proxy|evidence_review|application",
  "input": {
    "case_facts": "object",
    "legal_research": "object",
    "strategy": "object",
    "evidence": "array"
  },
  "requirements": {
    "length": "short|medium|long",
    "focus": "string",
    "special_requirements": "array"
  },
  "output": {
    "document": "string",
    "citations": "array",
    "word_count": "number"
  }
}
```

## 支持的文书类型

| 文书类型 | 适用场景 | 核心要素 |
|----------|----------|----------|
| 答辩状 | 收到起诉状后 | 答辩观点、反驳事实、反驳法律依据 |
| 代理词 | 庭审前/后 | 争议焦点、法律适用、事实陈述 |
| 质证意见 | 收到新证据后 | 三性质证、证明力评价、关联性分析 |
| 申请书 | 申请事项 | 申请依据、事实理由、法律条款 |
| 上诉状 | 不服一审判决 | 上诉请求、上诉理由、事实和法律 |
| 反驳书 | 对方提出主张后 | 反驳主张、反驳理由、反驳证据 |

## 文书结构模板

### 答辩状结构
```
一、答辩请求
二、事实和理由
  （一）对事实的答辩
  （二）对法律适用的答辩
三、证据目录
四、结语
```

### 代理词结构
```
一、案件争议焦点
二、对争议焦点的分析和意见
  （一）事实争议
  （二）法律争议
三、答辩方的主张和理由
四、结论
```

### 质证意见书结构
```
一、对证据真实性的质证
二、对证据合法性的质证
三、对证据关联性的质证
四、证明力评价
五、总体质证意见
```

## 质量标准与内嵌验证机制

### 基础质量标准

- **格式规范**：100% 符合法院文书格式
- **逻辑严密**：论证逻辑完整，无漏洞
- **引用准确**：法条和判例引用准确
- **语言规范**：使用标准法律术语

### 🛡️ 内嵌验证机制（Enhanced）

#### 验证阶段1：文书起草时实时验证
```yaml
实时验证检查项:
  1. 格式验证:
     - 标题格式（居中、标准字体）
     - 文号格式（符合法院要求）
     - 当事人信息格式（姓名、地址、身份证号）
     - 段落编号（一、（一）、1.、（1））
     - 结尾格式（此致、某某法院、具状人签名）

  2. 内容完整性检查:
     - 必填要素检查（当事人、诉讼请求、事实、理由）
     - 证据引用验证（证据编号与目录一致）
     - 法条引用准确性（条文编号、款、项）
     - 日期时效性（法条是否现行有效）

  3. 法律逻辑验证:
     - 事实与法律依据匹配度
     - 论证链条完整性
     - 争议焦点回应完整性
     - 策略方向一致性
```

#### 验证阶段2：文书输出前自动审查
```yaml
自动审查清单:
  1. 一致性检查:
     - 文书内容与案件事实一致
     - 诉讼请求与证据支撑一致
     - 法条引用与争议焦点对应
     - 策略方向与Strategist建议一致

  2. 风险预警:
     - 发现可能的法律漏洞
     - 识别证据不足的论述
     - 提示逻辑薄弱环节
     - 标记需要补充的内容

  3. 格式规范检查:
     - 法院文书格式符合度100%
     - 法律术语使用准确性
     - 标点符号和排版规范
     - 字数控制在合理范围
```

#### 验证阶段3：输出质量评分
```yaml
质量评分标准:
  A级（优秀）:
    - 格式规范度：100%
    - 内容完整性：100%
    - 逻辑严密性：95%以上
    - 引用准确性：100%

  B级（良好）:
    - 格式规范度：95%以上
    - 内容完整性：95%以上
    - 逻辑严密性：90-95%
    - 引用准确性：95%以上

  C级（需改进）:
    - 格式规范度：90-95%
    - 内容完整性：90-95%
    - 逻辑严密性：85-90%
    - 引用准确性：90-95%

  D级（不合格）:
    - 任何一项低于90%或存在明显错误
```

#### 错误处理与修正机制
```yaml
发现错误时的处理流程:
  1. 标记错误类型（格式、内容、逻辑、引用）
  2. 提供修正建议（具体到行和内容）
  3. 自动修正可选错误（格式类）
  4. 提示需人工确认的错误（内容类）
  5. 生成验证报告（详细记录检查过程）
```

#### 与Reviewer Agent的协作
```yaml
Reviewer协作机制:
  - Writer输出后自动调用Reviewer进行二次审查
  - Reviewer审查范围：跨Agent一致性、全局质量、风险评估
  - Reviewer输出：质量评估报告、修改建议、风险评级
  - 支持迭代优化：Writer根据Reviewer建议优化输出
```

## 集成说明

该组件与其他组件组合：
- **DocAnalyzer** + **BriefWriter** → 基于文档起草
- **LegalResearcher** + **BriefWriter** → 法律研究支持
- **StrategyPlanner** + **BriefWriter** → 策略指导
- **EvidenceHandler** + **BriefWriter** → 证据支持

---

## 法律文书模板库

该组件使用 `.claude/templates/legal_briefs/` 目录下的标准模板：

### 可用模板

| 模板名称 | 文件名 | 适用场景 |
|----------|--------|----------|
| 起诉状 | `complaint.md` | 提起诉讼 |
| 答辩状 | `defense.md` | 收到起诉状后 |
| 代理词 | `proxy_opinion.md` | 庭审前/后 |
| 质证意见书 | `evidence_opinion.md` | 对新证据质证 |
| 申请书 | `application.md` | 申请特定事项 |
| 上诉状 | `appeal.md` | 不服一审判决 |

### 使用示例

```json
{
  "brief_type": "defense",
  "template_used": "defense.md",
  "custom_sections": ["special_arguments"]
}
```

### 自定义模板

如需自定义模板：
1. 在 `.claude/templates/legal_briefs/` 创建新模板
2. 使用标准结构格式
3. 在组件中注册新模板

详细模板规范请参阅：`.claude/templates/legal_briefs/README.md`
